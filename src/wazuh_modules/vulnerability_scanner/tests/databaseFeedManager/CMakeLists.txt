cmake_minimum_required(VERSION 3.12.4)

project(database_feed_manager_unit_test)

set(CMAKE_CXX_FLAGS_DEBUG "-g --coverage -fsanitize=address,leak,undefined")


file(GLOB DATABASE_FEED_MANAGER_UNIT_TEST_SRC
    "*.cpp")

file(GLOB DATABASEFEED_MANAGER_SRC
    "${SRC_FOLDER}/wazuh_modules/vulnerability_scanner/src/databaseFeedManager/*.cpp"
    )

add_definitions(-DWAZUH_UNIT_TESTING)

# Link directories
link_directories(${SRC_FOLDER}/external/rocksdb/build)
link_directories(${SRC_FOLDER}/external/curl/lib/.libs/)

add_executable(database_feed_manager_unit_test
    ${DATABASE_FEED_MANAGER_UNIT_TEST_SRC} ${DATABASEFEED_MANAGER_SRC})

add_dependencies(database_feed_manager_unit_test compile_schemas) #Add a dependency between top-level targets.

target_compile_definitions(database_feed_manager_unit_test PUBLIC FLATBUFFER_SCHEMAS_DIR="${SRC_FOLDER}/wazuh_modules/vulnerability_scanner/schemas")

target_include_directories(database_feed_manager_unit_test
    PRIVATE "${SRC_FOLDER}/wazuh_modules/vulnerability_scanner/src/databaseFeedManager"
    )

target_link_libraries(database_feed_manager_unit_test
    debug gtestd
    debug gmockd
    debug gtest_maind
    debug gmock_maind
    optimized gtest
    optimized gmock
    optimized gtest_main
    optimized gmock_main
    router
    rocksdb
    flatbuffers
    urlrequest
    curl
    pthread
)

add_test(NAME database_feed_manager_unit_test
         COMMAND database_feed_manager_unit_test)

name: decoder/windows-base/0

metadata:
  description: "Windows base decoder"

sources:
  - decoder/json/0

check:
  - ~json.Message: +ef_exists
  - ~json.Event: +ef_exists

parse:
  logpar:
    - ~json.Event: <~winlog/xml/windows>

normalize:
  - map:
      # Base mapping, delete duplicated fields
      - winlog: $~winlog.Event
      - ~winlog: +ef_delete
      - ~json: +ef_delete
      - winlog.event_data: +ef_rename/$winlog.EventData

      # Normalize System fields
      - timestamp: $winlog.System.TimeCreated.@SystemTime
      - winlog.channel: $winlog.System.Channel.#text
      - winlog.computer_name: $winlog.System.Computer.#text
      - winlog.event_id: $winlog.System.EventID.#text
      - winlog.opcode: $winlog.System.Opcode.#text # Needs processing, number -> text
      - winlog.provider_guid: $winlog.System.Provider.@Guid
      - winlog.provider_name: $winlog.System.Provider.@Name
      - winlog.record_id: $winlog.System.EventRecordID.#text
      - winlog.task: $winlog.System.Task.#text # Needs processing, number -> text
      - winlog.version: $winlog.System.Version.#text
      - winlog.keywords: $winlog.System.Keywords.#text # Needs processing, hexa -> text
      - winlog.process.pid: $winlog.System.Execution.@ProcessID
      - winlog.process.thread.id: $winlog.System.Execution.@ThreadID
      - winlog.level: $winlog.System.Level.#text

      # Delete Reduntant and unused fields
      - winlog.System: +ef_delete
      - winlog.@xmlns: +ef_delete

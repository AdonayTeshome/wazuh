name: decoder/suricata/0

sources:
  - decoder/json/0

metadata:
  description: This decoder is the parent decoder for the suricata decoders
  references:
    - https://suricata.io/documentation/
  product.name: suricata module
  product.versions:
    - v4.0.4

check:
  - ~json.flow_id: +ef_exists

normalize:
  - map:
      - event.module: suricata

  - check:
      - ~json.event_type: +r_match/^(?:alert|dns|flow|ftp|ftp_data|http|http2|mqtt|smb|ssh|stats|tftp|tls|rdp|rfb)$
    map:
      - event.category: +a_append/network
      - event.end: $~json.flow.end
      - event.kind: event
      - event.start: $~json.flow.start
      - destination.address: $~json.dest_ip
      - destination.bytes: $~json.flow.bytes_toclient
      - destination.ip: $~json.dest_ip
      - destination.mac: $~json.ether.dest_mac
      - destination.packets: $~json.flow.pkts_toclient
      - destination.port: $~json.dest_port
      - file.path: $~json.fileinfo.filename
      - file.size: $~json.fileinfo.size
      - network.transport: $~json.proto
      - source.address: $~json.src_ip
      - source.bytes: $~json.flow.bytes_toserver
      - source.ip: $~json.src_ip
      - source.mac: $~json.ether.src_mac
      - source.packets: $~json.flow.pkts_toserver
      - source.port: $~json.src_port
      - timestamp: $~json.timestamp
      - network.protocol: $~json.app_proto

  - check:
      - network.protocol: http
    map:
      - destination.domain: $~json.http.hostname
      - event.category: +a_append/web
      - event.type: +a_append/access/protocol
      - http.request.method: $~json.http.http_method
      - http.request.referrer: $~json.http.http_refer
      - http.response.body.bytes: $~json.http.length
      - http.response.status_code: $~json.http.status
      - user_agent.original: $~json.http.http_user_agent
      - url.domain: $~json.http.hostname
      - url.original: $~json.http.url
      - url.port: $~json.http.http_port
